{"uid":"3aa79f3676fe5b45","name":"test_stress_concurrent_cancel_retry_complete","fullName":"tests.test_orchestrator_repository#test_stress_concurrent_cancel_retry_complete","historyId":"6086a216984b4aa4454fdba445db98f1","time":{"start":1771563337550,"stop":1771563341246,"duration":3696},"status":"failed","statusMessage":"AssertionError: assert 'f2237160-e6a...-1327db927560' == '1f5870cd-717...-e57d98be718e'\n  \n  - 1f5870cd-717b-4a13-86ed-e57d98be718e\n  + f2237160-e6a7-4a6b-95c6-1327db927560","statusTrace":"tmp_path = PosixPath('/tmp/pytest-of-runner/pytest-0/test_stress_concurrent_cancel_0')\n\n    @pytest.mark.skipif(\n        os.getenv(\"NEWS_RECAP_RUN_STRESS_TESTS\") != \"1\",\n        reason=\"Set NEWS_RECAP_RUN_STRESS_TESTS=1 to run long concurrency stress tests.\",\n    )\n    def test_stress_concurrent_cancel_retry_complete(tmp_path: Path) -> None:\n        db_path = tmp_path / \"orchestrator-stress-races.db\"\n        iterations = int(os.getenv(\"NEWS_RECAP_STRESS_ITERATIONS\", \"200\"))\n        repository = OrchestratorRepository(db_path)\n        repository.init_schema()\n    \n        for index in range(iterations):\n            task = repository.enqueue_task(\n                LlmTaskCreate(\n                    task_type=\"highlights\",\n                    run_after=datetime.now(tz=UTC),\n                    input_manifest_path=str(tmp_path / f\"manifest-{index}.json\"),\n                ),\n            )\n            claimed = repository.claim_next_ready_task(worker_id=f\"stress-worker-{index}\")\n            assert claimed is not None\n>           assert claimed.task_id == task.task_id\nE           AssertionError: assert 'f2237160-e6a...-1327db927560' == '1f5870cd-717...-e57d98be718e'\nE             \nE             - 1f5870cd-717b-4a13-86ed-e57d98be718e\nE             + f2237160-e6a7-4a6b-95c6-1327db927560\n\ntests/test_orchestrator_repository.py:905: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"tmp_path_factory","time":{"start":1771563323362,"stop":1771563323362,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path","time":{"start":1771563337549,"stop":1771563337550,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert 'f2237160-e6a...-1327db927560' == '1f5870cd-717...-e57d98be718e'\n  \n  - 1f5870cd-717b-4a13-86ed-e57d98be718e\n  + f2237160-e6a7-4a6b-95c6-1327db927560","statusTrace":"tmp_path = PosixPath('/tmp/pytest-of-runner/pytest-0/test_stress_concurrent_cancel_0')\n\n    @pytest.mark.skipif(\n        os.getenv(\"NEWS_RECAP_RUN_STRESS_TESTS\") != \"1\",\n        reason=\"Set NEWS_RECAP_RUN_STRESS_TESTS=1 to run long concurrency stress tests.\",\n    )\n    def test_stress_concurrent_cancel_retry_complete(tmp_path: Path) -> None:\n        db_path = tmp_path / \"orchestrator-stress-races.db\"\n        iterations = int(os.getenv(\"NEWS_RECAP_STRESS_ITERATIONS\", \"200\"))\n        repository = OrchestratorRepository(db_path)\n        repository.init_schema()\n    \n        for index in range(iterations):\n            task = repository.enqueue_task(\n                LlmTaskCreate(\n                    task_type=\"highlights\",\n                    run_after=datetime.now(tz=UTC),\n                    input_manifest_path=str(tmp_path / f\"manifest-{index}.json\"),\n                ),\n            )\n            claimed = repository.claim_next_ready_task(worker_id=f\"stress-worker-{index}\")\n            assert claimed is not None\n>           assert claimed.task_id == task.task_id\nE           AssertionError: assert 'f2237160-e6a...-1327db927560' == '1f5870cd-717...-e57d98be718e'\nE             \nE             - 1f5870cd-717b-4a13-86ed-e57d98be718e\nE             + f2237160-e6a7-4a6b-95c6-1327db927560\n\ntests/test_orchestrator_repository.py:905: AssertionError","steps":[],"attachments":[{"uid":"3f1959d6e9760f3d","name":"stderr","source":"3f1959d6e9760f3d.txt","type":"text/plain","size":397}],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":1,"stepsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"tmp_path::0","time":{"start":1771563341315,"stop":1771563341315,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"epic","value":"LLM Runtime"},{"name":"feature","value":"Task Queue Reliability"},{"name":"tag","value":"@pytest.mark.skipif(False, reason='Set NEWS_RECAP_RUN_STRESS_TESTS=1 to run long concurrency stress tests.')"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_orchestrator_repository"},{"name":"host","value":"runnervmwffz4"},{"name":"thread","value":"2724-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_orchestrator_repository"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":7,"unknown":0,"total":8},"items":[{"uid":"f58e48b2b4c36d37","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/17/index.html#testresult/f58e48b2b4c36d37","status":"passed","time":{"start":1771508638416,"stop":1771508660069,"duration":21653}},{"uid":"26a2fb42464d8a8c","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/16/index.html#testresult/26a2fb42464d8a8c","status":"passed","time":{"start":1771488759956,"stop":1771488785270,"duration":25314}},{"uid":"ab38ec7d81700d3e","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/15/index.html#testresult/ab38ec7d81700d3e","status":"passed","time":{"start":1771487971228,"stop":1771487993400,"duration":22172}},{"uid":"23f254f4aae722c7","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/14/index.html#testresult/23f254f4aae722c7","status":"passed","time":{"start":1771478487760,"stop":1771478505530,"duration":17770}},{"uid":"c4b0c9bd1f3b6ad7","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/13/index.html#testresult/c4b0c9bd1f3b6ad7","status":"passed","time":{"start":1771476151316,"stop":1771476173132,"duration":21816}},{"uid":"552d5350c87ae745","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/12/index.html#testresult/552d5350c87ae745","status":"passed","time":{"start":1771435211896,"stop":1771435233416,"duration":21520}},{"uid":"3b206b36875104fb","reportUrl":"https://andgineer.github.io/news-recap/builds/tests/11/index.html#testresult/3b206b36875104fb","status":"passed","time":{"start":1771432826441,"stop":1771432848586,"duration":22145}}]},"tags":["@pytest.mark.skipif(False, reason='Set NEWS_RECAP_RUN_STRESS_TESTS=1 to run long concurrency stress tests.')"]},"source":"3aa79f3676fe5b45.json","parameterValues":[]}